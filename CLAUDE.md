# CLAUDE.md - こころのしるべ

## プロジェクト概要

**こころのしるべ**は、AIを活用した日記・夢記録・ウィッシュリスト管理サービスです。

### コンセプト
「毎日がどんどん過ぎていってしまう」という課題に対し、日々の良かったこと・悪かったことを記録して振り返り、ウィッシュリストで人生を豊かにすることを目的としています。

### 主要機能
- **日記**: 音声・テキストで日々を記録、AI感情タグ・要約生成
- **夢記録**: 夢を記録し、AIによる夢占い機能
- **ウィッシュリスト**: 条件付き目標管理（年収、年齢などの条件で実施可能判定）
- **振り返り**: カレンダー・タイムラインでの閲覧、検索・フィルタ

### ターゲット
- 主に30代の男女
- 初期は個人利用

---

## ドキュメント構成

```
project-root/
├── CLAUDE.md              # このファイル（最初に読む）
├── docs/
│   ├── SPEC.md            # 詳細仕様書
│   ├── DEVELOPMENT.md     # 開発フェーズ・チェックリスト
│   ├── DEPLOYMENT.md      # デプロイフロー
│   ├── FUTURE.md          # 将来実装検討事項
│   └── DATABASE.md        # DB設計（実装時に作成）
```

### 各ファイルの役割

| ファイル | 内容 | 更新タイミング |
|----------|------|----------------|
| CLAUDE.md | プロジェクト概要、開発ルール | ルール変更時 |
| SPEC.md | 機能の詳細仕様 | 仕様変更時に必ず更新 |
| DEVELOPMENT.md | 開発タスク・チェックリスト | タスク完了時に必ず更新 |
| DEPLOYMENT.md | デプロイフロー・Vercel操作 | デプロイ手順変更時 |
| FUTURE.md | 将来実装予定の機能 | 新しい検討事項追加時 |

---

## 開発ルール（重要）

### 1. 仕様書の更新ルール

**仕様変更があった場合は、必ず該当するドキュメントを更新すること。**

- 機能仕様の変更 → `docs/SPEC.md` を更新
- 新しいタスクの追加 → `docs/DEVELOPMENT.md` を更新
- 将来機能の追加 → `docs/FUTURE.md` を更新

### 2. チェックリストの更新ルール

`docs/DEVELOPMENT.md` のチェックリストは、タスク完了時に必ず更新する。

```markdown
# 更新例
- [ ] 未完了のタスク
- [x] 完了したタスク ← チェックを入れる
```

### 3. コミットメッセージ規約

```
feat: 新機能追加
fix: バグ修正
docs: ドキュメント更新
style: コードスタイル修正
refactor: リファクタリング
test: テスト追加・修正
chore: その他
```

### 4. コード規約

- TypeScript を使用
- ESLint + Prettier でフォーマット
- コンポーネントは機能単位でディレクトリ分け
- shadcn/ui コンポーネントを優先使用

### 5. 実装計画のルール

**機能実装の前には、必ず Plan エージェントを使用して実装計画を立てること。**

- 複数ステップにわたる機能実装は、事前に計画を立てる
- Plan エージェントが出力した計画をレビューしてから実装を開始
- 計画には作成・修正するファイル、実装順序、検証方法を含める

### 6. コミット/プッシュのルール

**変更後は必ずユーザーに確認を依頼し、承認後にコミット/プッシュを行う。**

1. 変更を実装する
2. 「確認をお願いします」とユーザーに依頼
3. ユーザーから了承を得たら
4. 「コミット/プッシュしますか？」と確認してから実行

### 7. 仕様書同期ルール

**コード変更時は、必ず関連する仕様書も同時に更新すること。**

- 新機能追加 → `docs/SPEC.md` に仕様を追記
- UI変更 → `docs/SPEC.md` のUI仕様を更新
- タスク完了 → `docs/DEVELOPMENT.md` のチェックリストを更新
- コミット前に「仕様書の更新漏れがないか」を確認

**コミット前チェックリスト:**
- [ ] SPEC.md に機能仕様が記載されているか
- [ ] DEVELOPMENT.md のチェックリストを更新したか
- [ ] 更新履歴に記載したか

### 8. PR作成ルール

**PRを作成する前に、必ず既存PRの有無を確認すること。**

```bash
# 既存PRの確認
gh pr list -R takashiro-koichi/kokoro-no-shirube --head <ブランチ名>
```

- **PRが存在しない場合**: 新規PRを作成
- **PRが既に存在する場合**: 必要に応じてPRのタイトル・本文を更新

```bash
# PR作成（-R フラグ必須：サンドボックス環境のプロキシ対応）
gh pr create -R takashiro-koichi/kokoro-no-shirube --title "タイトル" --body "本文"

# 既存PRの更新
gh pr edit <PR番号> -R takashiro-koichi/kokoro-no-shirube --title "新タイトル" --body "新本文"
```

---

## 技術スタック

| 項目 | 技術 |
|------|------|
| フレームワーク | Next.js（App Router） |
| 言語 | TypeScript |
| DB | Supabase（PostgreSQL） |
| 認証 | Supabase Authentication（Google OAuth） |
| LLM | Anthropic API（Claude） |
| 音声入力 | Web Speech API |
| UIライブラリ | shadcn/ui |
| アニメーション | three.js |
| ホスティング | Vercel |

---

## 開発開始時のコマンド

```bash
# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev

# 型チェック
npm run type-check

# リント
npm run lint
```

---

## 重要な注意事項

1. **API制限**: 夢占いAPIは1日20回まで（ユーザーごと）
2. **音声整形**: 3パターン（軽め/しっかり/箇条書き）をユーザーが選択
3. **夢占い**: 3つの手法（ユング派/フロイト派/認知的アプローチ）から選択
4. **固有名詞**: 夢占いの精度向上のため、ユーザーが人物などを登録可能

---

## 次のアクション

1. `docs/DEVELOPMENT.md` を確認してフェーズ1のタスクから開始
2. 実装前に `docs/SPEC.md` で該当機能の仕様を確認
3. 実装完了後はチェックリストを更新
